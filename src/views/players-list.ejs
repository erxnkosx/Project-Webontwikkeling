<%- include('partials/header', { title: 'Players', page: 'players' }) %>

<h1>Players</h1>

<div class="card">
  <form method="get" action="/players" class="search-bar">
    <input
      type="text"
      name="q"
      placeholder="Search by player name"
      value="<%= q %>"
    />
    <button type="submit">Search</button>
    <button type="button" class="filter-toggle">Filter</button>

    <div
      class="filter-panel <%= (starter !== 'all' || clubName || sort !== 'name' || order !== 'asc') ? 'open' : '' %>"
    >
      <label>
        Sort by:
        <select name="sort">
          <option value="name"           <%= sort === 'name' ? 'selected' : '' %>>Name</option>
          <option value="club"           <%= sort === 'club' ? 'selected' : '' %>>Club</option>
          <option value="age"            <%= sort === 'age' ? 'selected' : '' %>>Age</option>
          <option value="position"       <%= sort === 'position' ? 'selected' : '' %>>Position</option>
          <option value="isStarter"      <%= sort === 'isStarter' ? 'selected' : '' %>>Starter</option>
          <option value="marketValueEur" <%= sort === 'marketValueEur' ? 'selected' : '' %>>Market value</option>
        </select>
      </label>

      <label>
        Order:
        <select name="order">
          <option value="asc"  <%= order === 'asc'  ? 'selected' : '' %>>Ascending</option>
          <option value="desc" <%= order === 'desc' ? 'selected' : '' %>>Descending</option>
        </select>
      </label>

      <label>
        Starter:
        <select name="starter">
          <option value="all" <%= starter === 'all' ? 'selected' : '' %>>All</option>
          <option value="yes" <%= starter === 'yes' ? 'selected' : '' %>>Yes</option>
          <option value="no"  <%= starter === 'no'  ? 'selected' : '' %>>No</option>
        </select>
      </label>

      <label>
        Search by club:
        <input
          type="text"
          name="clubName"
          placeholder="Club name..."
          value="<%= clubName %>"
        />
      </label>

      <button type="submit" class="btn-apply">Apply</button>
    </div>
  </form>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Player</th>
          <th>Club</th>
          <th>Age</th>
          <th>Position</th>
          <th>Starter</th>
          <th>Market value</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% players.forEach(p => { %>
          <tr>
            <td>
              <div class="player-cell">
                <img src="<%= p.imageUrl %>" alt="<%= p.name %>" class="player-avatar" />
                <span class="player-name"><%= p.name %></span>
              </div>
            </td>
            <td><%= p.club?.name ?? "Unknown club" %></td>
            <td><%= p.age %></td>
            <td><%= p.position %></td>
            <td>
              <% if (p.isStarter) { %>
                <span class="badge badge-yes">Yes</span>
              <% } else { %>
                <span class="badge badge-no">No</span>
              <% } %>
            </td>
            <td>â‚¬ <%= formatMarketValue(p.marketValueEur) %></td>
            <td><a class="btn-link" href="/players/<%= p.id %>">View</a></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.querySelector(".filter-toggle");
    const panel = document.querySelector(".filter-panel");
    if (!toggle || !panel) return;
    toggle.addEventListener("click", () => panel.classList.toggle("open"));
  });
</script>

<%- include('partials/footer') %>
